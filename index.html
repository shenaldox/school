<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jayapala School - Grade 11 System</title>
    
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Sinhala:wght@400;600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- CSS Reset & Variables --- */
        :root {
            --primary-color: #4e54c8;
            --secondary-color: #8f94fb;
            --glass-bg: rgba(20, 20, 20, 0.75); 
            --glass-bg-light: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.3);
            --text-color: #fff;
            --text-dark: #333;
            --card-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
            --owner-gold: #ffd700;
            --accent-red: #ff4757;
            --chat-bg: rgba(0, 0, 0, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Noto Sans Sinhala', sans-serif;
        }

        body {
            background: linear-gradient(45deg, #1cb5e0 0%, #000851 100%);
            min-height: 100vh;
            color: var(--text-color);
            overflow-x: hidden;
            background-image: url('https://picsum.photos/seed/school123/1920/1080');
            background-size: cover;
            background-attachment: fixed;
            background-blend-mode: overlay;
        }

        /* --- Animations --- */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        /* --- Glassmorphism Utilities --- */
        .glass {
            background: var(--glass-bg-light);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            box-shadow: var(--card-shadow);
        }

        .glass-content {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            box-shadow: var(--card-shadow);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            padding-top: 110px;
        }

        /* --- Navigation Bar --- */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            padding: 12px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
        }

        .logo {
            font-size: 1.4rem;
            font-weight: 700;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-links {
            display: flex;
            gap: 10px;
            list-style: none;
            overflow-x: auto;
        }

        .nav-links li a {
            text-decoration: none;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 20px;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .nav-links li a:hover, .nav-links li a.active {
            background: var(--primary-color);
            color: #fff;
            box-shadow: 0 4px 15px rgba(78, 84, 200, 0.4);
        }

        .user-badge {
            display: none;
            background: var(--primary-color);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            align-items: center;
            gap: 5px;
            animation: fadeIn 0.5s ease;
        }

        .owner-badge {
            background: linear-gradient(45deg, #ffd700, #ffaa00);
            color: #000;
            display: none;
        }

        /* --- Sections General --- */
        section {
            display: none;
            animation: fadeIn 0.6s ease-out;
        }

        section.active-section {
            display: block;
        }

        h2.section-title {
            margin-bottom: 30px;
            text-align: center;
            font-size: 2rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            border-bottom: 2px solid rgba(255,255,255,0.2);
            display: inline-block;
            padding-bottom: 10px;
            color: #fff;
        }

        /* --- Home Section --- */
        .hero {
            text-align: center;
            padding: 40px 20px;
        }
        
        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            background: linear-gradient(to right, #fff, #a1c4fd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .home-announcements {
            margin-top: 40px;
        }
        
        .home-ann-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--secondary-color);
            text-align: center;
        }

        /* --- Cards --- */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .card {
            padding: 25px;
            transition: transform 0.3s ease;
            text-align: center;
            position: relative;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        /* Announcement Cards */
        .ann-card {
            text-align: left;
            border-left: 5px solid var(--secondary-color);
            background: rgba(255, 255, 255, 0.15);
        }

        .ann-card.new {
            border-left: 5px solid var(--accent-red);
            background: rgba(255, 71, 87, 0.2);
        }

        .ann-date {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-bottom: 5px;
            display: block;
            color: #ccc;
        }

        .ann-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #fff;
            font-weight: 600;
        }
        
        .ann-card p {
            color: #eee;
        }

        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin-bottom: 15px;
            border: 3px solid var(--secondary-color);
            object-fit: cover;
        }

        /* --- Forms --- */
        .form-container {
            max-width: 500px;
            margin: 40px auto;
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(0,0,0,0.3);
            color: #fff;
            font-size: 1rem;
            outline: none;
            transition: 0.3s;
        }

        .form-control:focus {
            background: rgba(0,0,0,0.5);
            border-color: var(--secondary-color);
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
            font-size: 1rem;
        }

        .btn:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .btn-danger {
            background: linear-gradient(to right, #ff416c, #ff4b2b);
            margin-top: 15px;
        }

        /* --- Chat Room --- */
        .chat-container {
            height: 70vh;
            display: flex;
            flex-direction: column;
            background: var(--chat-bg);
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Message Bubbles - High Contrast */
        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 0.95rem;
            position: relative;
            animation: fadeIn 0.3s ease;
            word-wrap: break-word;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .msg-left {
            align-self: flex-start;
            background: #e0e0e0; /* Light Gray for others */
            color: #111; /* Dark text */
            border-bottom-left-radius: 4px;
        }

        .msg-right {
            align-self: flex-end;
            background: #8f94fb; /* Primary Blue for me */
            color: #fff;
            border-bottom-right-radius: 4px;
        }

        .msg-owner {
            align-self: center;
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            color: #000;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
            text-align: center;
            border: 2px solid #fff;
        }

        .msg-sender {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-bottom: 4px;
            display: block;
            font-weight: bold;
        }

        .chat-input-area {
            padding: 15px;
            display: flex;
            gap: 10px;
            background: rgba(0,0,0,0.5);
            border-radius: 0 0 16px 16px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        /* --- Reports --- */
        #report-list {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .report-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 8px;
            border-left: 5px solid var(--secondary-color);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .report-header {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 8px;
            margin-bottom: 8px;
        }

        /* --- Notifications --- */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(0,0,0,0.9);
            color: #fff;
            padding: 15px 25px;
            border-radius: 8px;
            border-left: 5px solid #00ff88;
            transform: translateX(200%);
            transition: transform 0.3s ease;
            z-index: 2000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .toast.show {
            transform: translateX(0);
        }

        /* --- Mobile Responsive --- */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
                padding-bottom: 20px;
                flex-direction: column;
                width: 100%;
            }
            .nav-links.mobile-active {
                display: flex;
                position: absolute;
                top: 60px;
                left: 0;
                background: rgba(0,0,0,0.95);
                padding: 20px;
                z-index: 999;
                gap: 15px;
            }
            .nav-links li {
                width: 100%;
            }
            .nav-links li a {
                display: block;
                width: 100%;
                padding: 12px;
            }
            nav {
                padding: 10px 15px;
            }
            .menu-toggle {
                display: block;
                color: #fff;
                font-size: 1.5rem;
                cursor: pointer;
            }
        }
        @media (min-width: 769px) {
            .menu-toggle {
                display: none;
            }
        }
    </style>
</head>
<body>

    <!-- Header / Navigation Bar -->
    <nav class="glass">
        <div class="logo">
            <i class="fas fa-school"></i> Jayapala School
        </div>
        
        <div class="menu-toggle" onclick="toggleMobileMenu()">
            <i class="fas fa-bars"></i>
        </div>

        <ul class="nav-links" id="navLinks">
            <li><a href="#" onclick="navigate('home')" class="active">Home</a></li>
            <li><a href="#" onclick="navigate('announcements')">Announcements</a></li>
            <li><a href="#" onclick="navigate('students')">‡∑É‡∑í‡∑É‡∑î‡∂±‡∑ä</a></li>
            <li><a href="#" onclick="navigate('teacher')">Teacher</a></li>
            <li><a href="#" onclick="navigate('chat')">Chat</a></li>
            <li><a href="#" onclick="navigate('reports')">Reports</a></li>
            <li><a href="#" onclick="navigate('credits')">Credit</a></li>
            
            <li id="nav-login"><a href="#" onclick="navigate('login')">Login</a></li>
            <li id="nav-register"><a href="#" onclick="navigate('register')">Register</a></li>
            <li id="nav-logout" style="display:none;"><a href="#" onclick="logout()">Logout</a></li>
        </ul>

        <div style="display: flex; gap: 10px;">
            <div id="user-display" class="user-badge">
                <i class="fas fa-user-check"></i> <span id="username-span"></span>
            </div>
            <div id="owner-display" class="user-badge owner-badge">
                <i class="fas fa-crown"></i>
            </div>
        </div>
    </nav>

    <div class="container">

        <!-- 1. Home Section -->
        <section id="home" class="active-section">
            <div class="hero glass-content">
                <h1>Grade 11 - Class of 2026</h1>
                <p>Jayapala School, Karukkuliya</p>
                <br>
                <p style="font-size: 1.1rem; max-width: 600px; margin: 0 auto; color: #ddd;">
                    ‡∂Ö‡∂¥‡∂ú‡∑ö ‡∂¥‡∂±‡∑ä‡∂≠‡∑í‡∂∫‡∑ö ‡∂≠‡∑ú‡∂ª‡∂≠‡∑î‡∂ª‡∑î, ‡∂¥‡∑ä‚Äç‡∂ª‡∑Ä‡∑ò‡∂≠‡∑ä‡∂≠‡∑í ‡∑É‡∑Ñ ‡∑É‡∑Ñ‡∂∫‡∑ù‡∂ú‡∂∫ ‡∑Ñ‡∑î‡∑Ä‡∂∏‡∑è‡∂ª‡∑î ‡∂ö‡∂ª ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂±‡∑í‡∂ª‡∑ä‡∂∏‡∑è‡∂´‡∂∫ ‡∂ö‡∂ª ‡∂á‡∂≠‡∑í ‡∂±‡∑Ä‡∑ì‡∂± ‡∑Ä‡∑ô‡∂∂‡∑ä ‡∂Ö‡∂©‡∑Ä‡∑í‡∂∫‡∂∫‡∑í.
                </p>
                <br>
                <button class="btn" style="width: auto; padding: 10px 30px;" onclick="navigate('students')">View Students</button>
            </div>

            <!-- Latest Announcements Preview -->
            <div class="home-announcements">
                <h3 class="home-ann-title"><i class="fas fa-bullhorn"></i> Latest News</h3>
                <div class="grid-container" id="home-ann-grid">
                    <!-- JS loads here -->
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <button class="btn" style="width: auto; background: rgba(255,255,255,0.1);" onclick="navigate('announcements')">View All Announcements</button>
                </div>
            </div>
        </section>

        <!-- 2. Announcements Section -->
        <section id="announcements">
            <center><h2 class="section-title">Class Announcements</h2></center>
            
            <!-- Owner Only: Add Announcement Form -->
            <div id="admin-announce-panel" class="glass-content form-container" style="display: none; border: 2px solid var(--owner-gold);">
                <h3 style="color: var(--owner-gold); margin-bottom: 15px; text-align: center;"><i class="fas fa-crown"></i> Post New Announcement</h3>
                <div class="form-group">
                    <label>‡∂∏‡∑è‡∂≠‡∑ò‡∂ö‡∑è‡∑Ä (Title)</label>
                    <input type="text" id="ann-title" class="form-control" placeholder="Eg: Extra Class Tomorrow">
                </div>
                <div class="form-group">
                    <label>‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª (Message)</label>
                    <textarea id="ann-msg" class="form-control" rows="4" placeholder="Announcement details..."></textarea>
                </div>
                <button class="btn" onclick="postAnnouncement()">Post Announcement</button>
                <br>
                <button class="btn btn-danger" onclick="clearAllAnnouncements()">Delete All</button>
            </div>

            <br>
            <div class="grid-container" id="announcement-grid">
                <!-- JS loads here -->
            </div>
        </section>

        <!-- 3. Students Section -->
        <section id="students">
            <center><h2 class="section-title">Grade 10 Students</h2></center>
            <div class="grid-container" id="student-grid">
                <!-- JS loads here -->
            </div>
        </section>

        <!-- 4. Teacher Section -->
        <section id="teacher">
            <center><h2 class="section-title">Class Teacher</h2></center>
            <div class="glass-content card" style="max-width: 500px; margin: 0 auto;">
                <img src="https://ui-avatars.com/api/?name=Pavithra+Hirushini&background=8f94fb&color=fff&size=150" alt="Teacher" class="avatar">
                <h3>M.R.S. Pavithra Hirushini</h3>
                <p style="font-weight: bold; color: var(--secondary-color); margin-bottom: 10px;">Grade 11 Class Teacher</p>
                <p>"We are committed to guiding our students towards a bright future."</p>
            </div>
        </section>

        <!-- 5. Chat Room -->
        <section id="chat">
            <center><h2 class="section-title">Class Chat Room</h2></center>
            <div class="glass-content chat-container">
                <div class="chat-messages" id="chat-box">
                    <!-- JS loads messages here -->
                </div>
                <div class="chat-input-area">
                    <input type="text" id="chat-input" class="form-control" placeholder="Type a message..." onkeypress="handleChatEnter(event)">
                    <button class="btn" style="width: auto;" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </section>

        <!-- 6. Report Sending -->
        <section id="reports">
            <center><h2 class="section-title">Report System</h2></center>
            
            <div class="glass-content form-container">
                <h3 style="margin-bottom: 20px;">Send a Report</h3>
                <div class="form-group">
                    <label>Your Name</label>
                    <input type="text" id="rep-name" class="form-control" placeholder="Name">
                </div>
                <div class="form-group">
                    <label>Subject</label>
                    <input type="text" id="rep-subject" class="form-control" placeholder="Subject">
                </div>
                <div class="form-group">
                    <label>Message</label>
                    <textarea id="rep-msg" class="form-control" rows="4" placeholder="Details..."></textarea>
                </div>
                <button class="btn" onclick="submitReport()">Submit Report</button>
            </div>

            <!-- Owner Only: View Reports -->
            <div id="report-list-container" class="glass-content" style="margin-top: 40px; padding: 20px; display: none;">
                <h3 style="margin-bottom: 20px; border-bottom: 1px solid #fff; padding-bottom: 10px;">
                    <i class="fas fa-file-alt"></i> Received Reports (Owner Only)
                </h3>
                
                <div id="report-list">
                    <!-- JS loads reports here -->
                </div>
            </div>
            
            <!-- Error / Info Message Area -->
            <div id="report-login-msg" class="glass-content" style="margin-top: 20px; padding: 15px; text-align: center; display: none; background: rgba(255, 71, 87, 0.2);">
                <i class="fas fa-lock"></i> Please login as <strong>Owner</strong> to view reports.
            </div>
        </section>

        <!-- 7. Credit Page -->
        <section id="credits">
            <center><h2 class="section-title">About Credit</h2></center>
            <div class="glass-content card" style="max-width: 400px; margin: 0 auto; animation: float 6s ease-in-out infinite;">
                <img src="https://picsum.photos/seed/shenal/150/150" alt="Shenal" class="avatar" style="border-color: var(--owner-gold);">
                <h3 style="color: var(--owner-gold);">Shenal Anuhas</h3>
                <p style="margin-bottom: 10px;"><strong>Age:</strong> 15+</p>
                <p style="margin-bottom: 20px;">Full Stack Developer</p>
                
                <a href="https://t.me/Crypto_RIV" target="_blank" class="btn" style="background: #0088cc;">
                    <i class="fab fa-telegram-plane"></i> Telegram
                </a>
            </div>
        </section>

        <!-- 8. Login Page -->
        <section id="login">
            <center><h2 class="section-title">Login</h2></center>
            <div class="glass-content form-container">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="login-name" class="form-control" placeholder="User Name">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="login-pass" class="form-control" placeholder="Password">
                </div>
                <button class="btn" onclick="login()">Login</button>
                <p style="margin-top: 15px; text-align: center; font-size: 0.9rem;">
                    No account? <a href="#" onclick="navigate('register')" style="color: var(--secondary-color);">Register</a>
                </p>
            </div>
        </section>

        <!-- 9. Register Page -->
        <section id="register">
            <center><h2 class="section-title">Register</h2></center>
            <div class="glass-content form-container">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="reg-name" class="form-control" placeholder="Your Name">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="reg-pass" class="form-control" placeholder="Create Password">
                </div>
                <button class="btn" onclick="register()">Create Account</button>
                <p style="margin-top: 15px; text-align: center; font-size: 0.9rem;">
                    Already have an account? <a href="#" onclick="navigate('login')" style="color: var(--secondary-color);">Login</a>
                </p>
            </div>
        </section>

    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">Operation Successful</div>

    <script>
        // --- Data Section ---
        const studentsData = [
            { name: "‡∂â‡∑Ç‡∑è‡∂±‡∑ä ‡∂±‡∑ô‡∂≠‡∑ä‡∂∏‡∑í‡∂ö", desc: "‡∂â‡∑Ç‡∑è‡∂±‡∑ä ‡∑Ñ‡∑ú‡∂≥ ‡∂ú‡∑î‡∂´‡∂ú‡∂≠‡∑í‡∂ö ‡∂Ø‡∂ª‡∑î‡∑Ä‡∑ô‡∂ö‡∑í.", color: "#ff7675" },
            { name: "‡∑Ñ‡∑í‡∂∏‡∑è‡∑Ç‡∑ä ‡∑É‡∂Ç‡∂¢‡∂±", desc: "‡∂¥‡∑É‡∑î‡∂ú‡∑í‡∂∫ ‡∑Ä‡∑É‡∂ª ‡∂ö‡∑í‡∑Ñ‡∑í‡∂¥‡∂∫ ‡∂≠‡∑î‡∑Ö ‡∂¥‡∑è‡∑É‡∂Ω‡∑ä ‡∂¥‡∑ê‡∂∏‡∑í‡∂´‡∑ì‡∂∏ ‡∂Ö‡∂©‡∑î ‡∑Ä‡∑ì ‡∂á‡∂≠.", color: "#74b9ff" },
            { name: "‡∂â‡∑É‡∑î‡∂ª‡∑î ‡∂∏‡∂Ø‡∑î‡∑É‡∂Ç‡∂õ", desc: "‡∂â‡∂≠‡∑è ‡∂ã‡∂±‡∂±‡∑ä‡∂Ø‡∑î‡∑Ä‡∑ô‡∂±‡∑ä ‡∂Ö‡∂∞‡∑ä‚Äç‡∂∫‡∑è‡∂¥‡∂±‡∂∫ ‡∂ö‡∂ª‡∂∫‡∑í.", color: "#55efc4" },
            { name: "‡∂±‡∑Ä‡∑ì‡∂±‡∑ä ‡∂≠‡∂ª‡∑î‡∑Ç", desc: "‡∂â‡∂≠‡∑è ‡∂∂‡∑î‡∂Ø‡∑ä‡∂∞‡∑í‡∂∏‡∂≠‡∑ä ‡∂Ø‡∂ª‡∑î‡∑Ä‡∑ô‡∂ö‡∑í.", color: "#ffeaa7" },
            { name: "‡∂∏‡∑è‡∂Ω‡∑í‡∂Ø‡∑î ‡∑Ñ‡∑í‡∂ª‡∑î‡∑Ç‡∑è‡∂±‡∑ä", desc: "‡∂â‡∂≠‡∑è ‡∂ö‡∑ê‡∂¥‡∑Ä‡∑ì‡∂∏‡∑ô‡∂±‡∑ä ‡∂Ö‡∂∞‡∑ä‚Äç‡∂∫‡∑è‡∂¥‡∂±‡∂∫ ‡∂ö‡∂ª‡∂± ‡∂Ø‡∂ª‡∑î‡∑Ä‡∑ô‡∂ö‡∑í.", color: "#a29bfe" },
            { name: "‡∂≠‡∑í‡∂ö‡∑ä‡∑Ç‡∂´ ‡∑Ä‡∑í‡∂Ø‡∑î‡∂ª‡∂Ç‡∂ú", desc: "‡∂ã‡∂±‡∂±‡∑ä‡∂Ø‡∑î‡∑Ä ‡∑Ñ‡∑ö‡∂≠‡∑î‡∑Ä‡∑ô‡∂±‡∑ä ‡∂¢‡∑ì‡∑Ä‡∑í‡∂≠‡∂∫‡∑ö ‡∂Ö‡∂∑‡∑í‡∂∫‡∑ù‡∂ú ‡∂¢‡∂∫‡∂ú‡∂≠ ‡∑Ñ‡∑ê‡∂ö‡∑í.", color: "#fd79a8" },
            { name: "‡∑É‡∂Ç‡∂¢‡∂± ‡∂¥‡∑ä‚Äç‡∂ª‡∂∂‡∂≠‡∑ä", desc: "Free Fire ‡∑Ä‡∑ì‡∂©‡∑í‡∂∫‡∑ù ‡∂ö‡∑ä‚Äç‡∂ª‡∑ì‡∂©‡∑è‡∑Ä‡∂ß ‡∂á‡∂∂‡∑ä‡∂∂‡∑ê‡∑Ñ‡∑í‡∑Ä‡∑ì‡∂∏ ‡∂±‡∑í‡∑É‡∑è ‡∂Ö‡∂∞‡∑ä‚Äç‡∂∫‡∑è‡∂¥‡∂±‡∂∫ ‡∂±‡∑ú‡∑É‡∂Ω‡∂ö‡∑è ‡∑Ñ‡∂ª‡∑í‡∂∏‡∑í‡∂±‡∑ä ‡∑É‡∑í‡∂ß‡∑ì.", color: "#e17055" },
            { name: "‡∑Å‡∑ô‡∂±‡∑è‡∂Ω‡∑ä ‡∂Ö‡∂±‡∑î‡∑Ñ‡∑É‡∑ä", desc: "Developer.", color: "#6c5ce7", isOwner: true },
            { name: "‡∂≠‡∑è‡∂ª‡∂ö ‡∂¥‡∑ä‚Äç‡∂ª‡∑É‡∂±‡∑ä‡∂±", desc: "‡∂≠‡∑è‡∂ª‡∂ö ‡∂ú‡∑ê‡∂± ‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª ‡∂±‡∑ú‡∂Ø‡∂ö‡∑ä‡∑Ä‡∂∫‡∑í üòê", color: "#b2bec3" }
        ];

        // --- State Management ---
        let currentUser = null;
        let isOwner = false;

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            renderStudents();
            checkSession();
            loadChat();
            loadAnnouncements();
        });

        // --- Navigation Logic ---
        function navigate(sectionId) {
            document.querySelectorAll('section').forEach(sec => sec.classList.remove('active-section'));
            document.querySelectorAll('.nav-links a').forEach(link => link.classList.remove('active'));

            document.getElementById(sectionId).classList.add('active-section');
            
            const links = document.querySelectorAll('.nav-links a');
            links.forEach(link => {
                if(link.getAttribute('onclick').includes(sectionId)) {
                    link.classList.add('active');
                }
            });

            document.getElementById('navLinks').classList.remove('mobile-active');

            // Refresh specific components when navigating
            if(sectionId === 'reports') {
                loadReports();
            }
            if(sectionId === 'announcements') {
                renderAnnouncements(); 
            }
            if(sectionId === 'home') {
                renderHomeAnnouncements();
            }
            if(sectionId === 'chat') {
                // Ensure chat is loaded and scrolled
                loadChat();
                scrollToBottom();
            }
        }

        function toggleMobileMenu() {
            document.getElementById('navLinks').classList.toggle('mobile-active');
        }

        // --- Render Students ---
        function renderStudents() {
            const grid = document.getElementById('student-grid');
            grid.innerHTML = '';
            studentsData.forEach((student) => {
                const avatarUrl = student.isOwner 
                    ? `https://ui-avatars.com/api/?name=${student.name}&background=ffd700&color=000&bold=true`
                    : `https://ui-avatars.com/api/?name=${student.name}&background=random`;

                const card = document.createElement('div');
                card.className = 'glass-content card';
                card.innerHTML = `
                    <img src="${avatarUrl}" alt="${student.name}" class="avatar">
                    <h3>${student.name} ${student.isOwner ? '<i class="fas fa-crown" style="color: gold;"></i>' : ''}</h3>
                    <p>${student.desc}</p>
                `;
                grid.appendChild(card);
            });
        }

        // --- Announcement System ---
        function loadAnnouncements() {
            let announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            if (announcements.length === 0) {
                const defaultAnn = {
                    id: Date.now(),
                    title: "Welcome to Jayapala School System",
                    msg: "Welcome! This is the default announcement.",
                    date: new Date().toLocaleDateString()
                };
                announcements.push(defaultAnn);
                localStorage.setItem('announcements', JSON.stringify(announcements));
            }
            renderAnnouncements();
            renderHomeAnnouncements();
        }

        function renderHomeAnnouncements() {
            const grid = document.getElementById('home-ann-grid');
            const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            grid.innerHTML = '';

            announcements.sort((a, b) => b.id - a.id);
            const previewList = announcements.slice(0, 2);

            previewList.forEach((ann) => {
                const card = document.createElement('div');
                const isToday = ann.date === new Date().toLocaleDateString();
                const cardClass = isToday ? 'glass-content ann-card new' : 'glass-content ann-card';

                card.innerHTML = `
                    <span class="ann-date"><i class="far fa-calendar-alt"></i> ${ann.date}</span>
                    <h3 class="ann-title">${ann.title}</h3>
                    <p>${ann.msg.substring(0, 100)}${ann.msg.length > 100 ? '...' : ''}</p>
                `;
                card.className = cardClass;
                grid.appendChild(card);
            });
        }

        function renderAnnouncements() {
            const grid = document.getElementById('announcement-grid');
            const adminPanel = document.getElementById('admin-announce-panel');
            const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            
            grid.innerHTML = '';

            if (isOwner) {
                adminPanel.style.display = 'block';
            } else {
                adminPanel.style.display = 'none';
            }

            announcements.sort((a, b) => b.id - a.id);

            announcements.forEach((ann) => {
                const card = document.createElement('div');
                const isToday = ann.date === new Date().toLocaleDateString();
                const cardClass = isToday ? 'glass-content ann-card new' : 'glass-content ann-card';

                card.innerHTML = `
                    <span class="ann-date"><i class="far fa-calendar-alt"></i> ${ann.date}</span>
                    <h3 class="ann-title">${ann.title}</h3>
                    <p>${ann.msg}</p>
                `;
                card.className = cardClass;
                grid.appendChild(card);
            });
        }

        function postAnnouncement() {
            const title = document.getElementById('ann-title').value.trim();
            const msg = document.getElementById('ann-msg').value.trim();

            if (!title || !msg) {
                showToast("Please enter a title and message.");
                return;
            }

            const newAnn = {
                id: Date.now(),
                title: title,
                msg: msg,
                date: new Date().toLocaleDateString()
            };

            const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            announcements.push(newAnn);
            localStorage.setItem('announcements', JSON.stringify(announcements));

            document.getElementById('ann-title').value = '';
            document.getElementById('ann-msg').value = '';

            showToast("Announcement Posted!");
            renderAnnouncements();
            renderHomeAnnouncements();
        }

        function clearAllAnnouncements() {
            if(confirm("Delete all announcements?")) {
                localStorage.removeItem('announcements');
                loadAnnouncements();
                showToast("All announcements cleared.");
            }
        }

        // --- Authentication System ---
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.innerText = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function checkSession() {
            const user = localStorage.getItem('currentUser');
            if (user) {
                const userData = JSON.parse(user);
                loginSuccess(userData.name, userData.isOwner, false);
            }
        }

        function register() {
            const name = document.getElementById('reg-name').value.trim();
            const pass = document.getElementById('reg-pass').value.trim();

            if (!name || !pass) {
                showToast("Please fill in all fields.");
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            if (users.find(u => u.name === name)) {
                showToast("User already exists.");
                return;
            }

            users.push({ name, pass });
            localStorage.setItem('users', JSON.stringify(users));
            showToast("Registration successful!");
            navigate('login');
        }

        function login() {
            const name = document.getElementById('login-name').value.trim();
            const pass = document.getElementById('login-pass').value.trim();

            if (name === 'Shenal Anuhas' && pass === 'shenal11') {
                loginSuccess(name, true, true);
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const validUser = users.find(u => u.name === name && u.pass === pass);

            if (validUser) {
                loginSuccess(validUser.name, false, true);
            } else {
                showToast("Invalid username or password.");
            }
        }

        function loginSuccess(name, ownerFlag, saveSession) {
            currentUser = name;
            isOwner = ownerFlag;

            document.getElementById('nav-login').style.display = 'none';
            document.getElementById('nav-register').style.display = 'none';
            document.getElementById('nav-logout').style.display = 'block';
            document.getElementById('user-display').style.display = 'flex';
            document.getElementById('username-span').innerText = name;

            if (isOwner) {
                document.getElementById('owner-display').style.display = 'flex';
            } else {
                document.getElementById('owner-display').style.display = 'none';
            }

            if (saveSession) {
                localStorage.setItem('currentUser', JSON.stringify({ name, isOwner }));
            }
            
            showToast(`Welcome, ${name}!`);
            
            // Reload Chat to update user's own messages styling
            loadChat(); 
            
            navigate('home');
            renderAnnouncements(); 
        }

        function logout() {
            localStorage.removeItem('currentUser');
            currentUser = null;
            isOwner = false;

            document.getElementById('nav-login').style.display = 'block';
            document.getElementById('nav-register').style.display = 'block';
            document.getElementById('nav-logout').style.display = 'none';
            document.getElementById('user-display').style.display = 'none';
            document.getElementById('owner-display').style.display = 'none';
            
            document.getElementById('login-name').value = '';
            document.getElementById('login-pass').value = '';

            showToast("Logged out.");
            navigate('home');
            
            // Reload Chat to clear styling for own messages
            loadChat();
            renderAnnouncements();
        }

        // --- Chat Room Logic (FIXED) ---
        function loadChat() {
            const chatBox = document.getElementById('chat-box');
            const messages = JSON.parse(localStorage.getItem('chatMessages') || '[]');
            
            chatBox.innerHTML = '';
            
            // If empty, show a system message
            if (messages.length === 0) {
                const sysMsg = document.createElement('div');
                sysMsg.style.textAlign = 'center';
                sysMsg.style.opacity = '0.6';
                sysMsg.style.padding = '20px';
                sysMsg.innerText = "No messages yet. Start the conversation!";
                chatBox.appendChild(sysMsg);
            }

            messages.forEach(msg => {
                appendMessageToUI(msg);
            });
            scrollToBottom();
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            
            if (!text) return;
            if (!currentUser) {
                showToast("Please login to chat.");
                return;
            }

            const newMessage = {
                user: currentUser,
                text: text,
                isOwner: isOwner,
                time: new Date().toLocaleTimeString()
            };

            const messages = JSON.parse(localStorage.getItem('chatMessages') || '[]');
            messages.push(newMessage);
            localStorage.setItem('chatMessages', JSON.stringify(messages));

            appendMessageToUI(newMessage);
            input.value = '';
            scrollToBottom();
        }

        function appendMessageToUI(msg) {
            const chatBox = document.getElementById('chat-box');
            
            // If chat box is empty except system msg, clear it first (optional polish)
            if (chatBox.children.length === 1 && chatBox.children[0].innerText === "No messages yet. Start the conversation!") {
                chatBox.innerHTML = '';
            }

            const div = document.createElement('div');
            
            let className = 'message msg-left'; // Default: Others (Left)
            
            // Logic: If I sent it -> Right. If Owner sent it -> Center.
            if (msg.isOwner) {
                className = 'message msg-owner';
            } else if (msg.user === currentUser) {
                className = 'message msg-right';
            }

            div.innerHTML = `
                <span class="msg-sender">${msg.user} ${msg.isOwner ? '<i class="fas fa-crown"></i>' : ''} ‚Ä¢ ${msg.time}</span>
                ${msg.text}
            `;
            div.className = className;
            chatBox.appendChild(div);
        }

        function scrollToBottom() {
            const chatBox = document.getElementById('chat-box');
            // Small delay to ensure DOM updated
            setTimeout(() => {
                chatBox.scrollTop = chatBox.scrollHeight;
            }, 50);
        }

        function handleChatEnter(e) {
            if (e.key === 'Enter') sendMessage();
        }

        // --- Report System Logic (FIXED) ---
        function submitReport() {
            const name = document.getElementById('rep-name').value.trim();
            const subject = document.getElementById('rep-subject').value.trim();
            const msg = document.getElementById('rep-msg').value.trim();

            if (!name || !subject || !msg) {
                showToast("Please fill all fields.");
                return;
            }

            const newReport = { name, subject, msg, date: new Date().toLocaleString() };
            
            const reports = JSON.parse(localStorage.getItem('reports') || '[]');
            reports.push(newReport);
            localStorage.setItem('reports', JSON.stringify(reports));

            showToast("Report sent successfully!");

            document.getElementById('rep-name').value = '';
            document.getElementById('rep-subject').value = '';
            document.getElementById('rep-msg').value = '';
        }

        function loadReports() {
            const container = document.getElementById('report-list-container');
            const list = document.getElementById('report-list');
            const errorMsg = document.getElementById('report-login-msg');
            
            // Always reset visibility
            container.style.display = 'none';
            errorMsg.style.display = 'none';

            if (!currentUser || !isOwner) {
                // Not logged in as owner
                errorMsg.style.display = 'block';
                return;
            }

            // Logged in as owner
            container.style.display = 'block';
            
            const reports = JSON.parse(localStorage.getItem('reports') || '[]');
            
            if (reports.length === 0) {
                list.innerHTML = '<div style="text-align:center; padding:20px; opacity:0.7;"><i class="fas fa-folder-open"></i> No reports submitted yet.</div>';
                return;
            }

            list.innerHTML = '';
            // Show newest first
            reports.reverse().forEach((rep, index) => {
                const item = document.createElement('div');
                item.className = 'report-item glass-content';
                item.innerHTML = `
                    <div class="report-header">
                        <strong>${rep.subject}</strong>
                        <small style="color:#ccc;">${rep.date}</small>
                    </div>
                    <p style="margin-bottom: 5px; font-weight:600; color:var(--secondary-color);">From: ${rep.name}</p>
                    <p style="margin-top: 10px; line-height: 1.4;">${rep.msg}</p>
                `;
                list.appendChild(item);
            });
        }
    </script>
</body>
</html>
