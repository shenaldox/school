<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jayapala School - Grade 10 System</title>
    
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Sinhala:wght@400;600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- CSS Reset & Variables --- */
        :root {
            --primary-color: #4e54c8;
            --secondary-color: #8f94fb;
            --glass-bg: rgba(20, 20, 20, 0.75); 
            --glass-bg-light: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.3);
            --text-color: #fff;
            --text-dark: #333;
            --card-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
            --owner-gold: #ffd700;
            --accent-red: #ff4757;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Noto Sans Sinhala', sans-serif;
        }

        body {
            background: linear-gradient(45deg, #1cb5e0 0%, #000851 100%);
            min-height: 100vh;
            color: var(--text-color);
            overflow-x: hidden;
            background-image: url('https://picsum.photos/seed/school123/1920/1080');
            background-size: cover;
            background-attachment: fixed;
            background-blend-mode: overlay;
        }

        /* --- Animations --- */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        @keyframes typing {
            0% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0); }
        }

        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* --- Glassmorphism Utilities --- */
        .glass {
            background: var(--glass-bg-light);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            box-shadow: var(--card-shadow);
        }

        .glass-content {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            box-shadow: var(--card-shadow);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            padding-top: 110px;
        }

        /* --- Navigation Bar --- */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            padding: 12px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
        }

        .logo {
            font-size: 1.4rem;
            font-weight: 700;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-links {
            display: flex;
            gap: 10px;
            list-style: none;
            overflow-x: auto;
        }

        .nav-links li a {
            text-decoration: none;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 20px;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .nav-links li a:hover, .nav-links li a.active {
            background: var(--primary-color);
            color: #fff;
            box-shadow: 0 4px 15px rgba(78, 84, 200, 0.4);
        }

        .nav-links li a.forum-link {
            background: rgba(0, 255, 128, 0.2);
            border: 1px solid rgba(0, 255, 128, 0.5);
            color: #00ff88;
        }
        .nav-links li a.forum-link:hover {
            background: #00ff88;
            color: #000;
        }

        .user-badge {
            display: none;
            background: var(--primary-color);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            align-items: center;
            gap: 5px;
            animation: fadeIn 0.5s ease;
        }

        .owner-badge {
            background: linear-gradient(45deg, #ffd700, #ffaa00);
            color: #000;
            display: none;
        }

        /* --- Sections General --- */
        section {
            display: none;
            animation: fadeIn 0.6s ease-out;
        }

        section.active-section {
            display: block;
        }

        h2.section-title {
            margin-bottom: 30px;
            text-align: center;
            font-size: 2rem;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            border-bottom: 2px solid rgba(255,255,255,0.2);
            display: inline-block;
            padding-bottom: 10px;
            color: #fff;
        }

        /* --- Home Section --- */
        .hero {
            text-align: center;
            padding: 40px 20px;
        }
        
        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            background: linear-gradient(to right, #fff, #a1c4fd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .home-announcements {
            margin-top: 40px;
        }
        
        .home-ann-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--secondary-color);
            text-align: center;
        }

        /* --- Cards --- */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .card {
            padding: 25px;
            transition: transform 0.3s ease;
            text-align: center;
            position: relative;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .ann-card {
            text-align: left;
            border-left: 5px solid var(--secondary-color);
            background: rgba(255, 255, 255, 0.15);
        }

        .ann-card.new {
            border-left: 5px solid var(--accent-red);
            background: rgba(255, 71, 87, 0.2);
        }

        .ann-date {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-bottom: 5px;
            display: block;
            color: #ccc;
        }

        .ann-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #fff;
            font-weight: 600;
        }
        
        .ann-card p {
            color: #eee;
        }

        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin-bottom: 15px;
            border: 3px solid var(--secondary-color);
            object-fit: cover;
        }

        /* --- Forms --- */
        .form-container {
            max-width: 500px;
            margin: 40px auto;
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(0,0,0,0.3);
            color: #fff;
            font-size: 1rem;
            outline: none;
            transition: 0.3s;
        }

        .form-control:focus {
            background: rgba(0,0,0,0.5);
            border-color: var(--secondary-color);
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
            font-size: 1rem;
        }

        .btn:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .btn-danger {
            background: linear-gradient(to right, #ff416c, #ff4b2b);
            margin-top: 15px;
        }

        /* --- Reports --- */
        #report-list {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .report-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 8px;
            border-left: 5px solid var(--secondary-color);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .report-header {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 8px;
            margin-bottom: 8px;
        }

        /* --- Notifications --- */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(0,0,0,0.9);
            color: #fff;
            padding: 15px 25px;
            border-radius: 8px;
            border-left: 5px solid #00ff88;
            transform: translateX(200%);
            transition: transform 0.3s ease;
            z-index: 2000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .toast.show {
            transform: translateX(0);
        }

        /* --- AI Chatbot Widget Styles --- */
        #ai-chat-widget {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1500;
            font-family: 'Poppins', sans-serif;
        }

        #chat-toggle-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00c6ff, #0072ff);
            border: none;
            box-shadow: 0 4px 15px rgba(0, 114, 255, 0.4);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s;
            animation: float 4s ease-in-out infinite;
        }

        #chat-toggle-btn:hover {
            transform: scale(1.1);
        }

        #chat-toggle-btn i {
            color: #fff;
            font-size: 28px;
        }

        #chat-window {
            position: absolute;
            bottom: 80px;
            right: 0;
            width: 350px;
            height: 500px;
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            display: none; /* Hidden by default */
            flex-direction: column;
            overflow: hidden;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        #chat-header {
            background: linear-gradient(to right, #4e54c8, #8f94fb);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #chat-header h3 {
            font-size: 1rem;
            color: #fff;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chat-controls {
            display: flex;
            gap: 8px;
        }

        .lang-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: #fff;
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: 0.2s;
        }

        .lang-btn.active {
            background: #fff;
            color: #4e54c8;
            font-weight: bold;
        }

        #close-chat {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.2rem;
            cursor: pointer;
        }

        #chat-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: rgba(255,255,255,0.05);
        }

        .chat-msg {
            max-width: 80%;
            padding: 10px 14px;
            border-radius: 12px;
            font-size: 0.85rem;
            line-height: 1.4;
            animation: fadeIn 0.3s;
        }

        .msg-ai {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.1);
            color: #ddd;
            border-bottom-left-radius: 2px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .msg-user {
            align-self: flex-end;
            background: #4e54c8;
            color: #fff;
            border-bottom-right-radius: 2px;
        }

        #chat-footer {
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            gap: 8px;
        }

        #chat-input {
            flex: 1;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 8px 15px;
            color: #fff;
            outline: none;
            font-size: 0.9rem;
        }

        #send-chat {
            background: var(--primary-color);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .typing-indicator {
            display: none;
            align-self: flex-start;
            background: rgba(255,255,255,0.1);
            padding: 8px 12px;
            border-radius: 12px;
            border-bottom-left-radius: 2px;
            font-size: 0.8rem;
            color: #aaa;
        }

        .typing-dots span {
            display: inline-block;
            width: 6px;
            height: 6px;
            background-color: #aaa;
            border-radius: 50%;
            margin: 0 2px;
            animation: typing 1.4s infinite ease-in-out both;
        }
        
        .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
        .typing-dots span:nth-child(2) { animation-delay: -0.16s; }

        .chat-disclaimer {
            font-size: 0.65rem;
            text-align: center;
            color: #888;
            padding: 5px;
            border-top: 1px solid rgba(255,255,255,0.05);
        }

        /* --- Mobile Responsive --- */
        @media (max-width: 768px) {
            .nav-links { display: none; padding-bottom: 20px; flex-direction: column; width: 100%; }
            .nav-links.mobile-active {
                display: flex; position: absolute; top: 60px; left: 0; background: rgba(0,0,0,0.95); padding: 20px; z-index: 999; gap: 15px;
            }
            .nav-links li { width: 100%; }
            .nav-links li a { display: block; width: 100%; padding: 12px; }
            nav { padding: 10px 15px; }
            .menu-toggle { display: block; color: #fff; font-size: 1.5rem; cursor: pointer; }
            
            #chat-window {
                width: 90%;
                right: 5%;
                bottom: 90px;
                height: 60vh;
            }
        }
        @media (min-width: 769px) {
            .menu-toggle { display: none; }
        }
    </style>
</head>
<body>

    <!-- Header / Navigation Bar -->
    <nav class="glass">
        <div class="logo">
            <i class="fas fa-school"></i> Jayapala School
        </div>
        
        <div class="menu-toggle" onclick="toggleMobileMenu()">
            <i class="fas fa-bars"></i>
        </div>

        <ul class="nav-links" id="navLinks">
            <li><a href="#" onclick="navigate('home')" class="active">Home</a></li>
            <li><a href="#" onclick="navigate('announcements')">Announcements</a></li>
            <li><a href="#" onclick="navigate('students')">‡∑É‡∑í‡∑É‡∑î‡∂±‡∑ä</a></li>
            <li><a href="#" onclick="navigate('teacher')">Teacher</a></li>
            <li><a href="https://shenaldox.github.io/chatroom/" target="_blank" class="forum-link"><i class="fas fa-comments"></i> Forum</a></li>
            <li><a href="#" onclick="navigate('reports')">Reports</a></li>
            <li><a href="#" onclick="navigate('credits')">Credit</a></li>
            
            <li id="nav-login"><a href="#" onclick="navigate('login')">Login</a></li>
            <li id="nav-register"><a href="#" onclick="navigate('register')">Register</a></li>
            <li id="nav-logout" style="display:none;"><a href="#" onclick="logout()">Logout</a></li>
        </ul>

        <div style="display: flex; gap: 10px;">
            <div id="user-display" class="user-badge">
                <i class="fas fa-user-check"></i> <span id="username-span"></span>
            </div>
            <div id="owner-display" class="user-badge owner-badge">
                <i class="fas fa-crown"></i>
            </div>
        </div>
    </nav>

    <div class="container">

        <!-- 1. Home Section -->
        <section id="home" class="active-section">
            <div class="hero glass-content">
                <h1>Grade 11 - Class of 2024</h1>
                <p>Jayapala School, Karukkuliya</p>
                <br>
                <p style="font-size: 1.1rem; max-width: 600px; margin: 0 auto; color: #ddd;">
                    ‡∂Ö‡∂¥‡∂ú‡∑ö ‡∂¥‡∂±‡∑ä‡∂≠‡∑í‡∂∫‡∑ö ‡∂≠‡∑ú‡∂ª‡∂≠‡∑î‡∂ª‡∑î, ‡∂¥‡∑ä‚Äç‡∂ª‡∑Ä‡∑ò‡∂≠‡∑ä‡∂≠‡∑í ‡∑É‡∑Ñ ‡∑É‡∑Ñ‡∂∫‡∑ù‡∂ú‡∂∫ ‡∑Ñ‡∑î‡∑Ä‡∂∏‡∑è‡∂ª‡∑î ‡∂ö‡∂ª ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏ ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂±‡∑í‡∂ª‡∑ä‡∂∏‡∑è‡∂´‡∂∫ ‡∂ö‡∂ª ‡∂á‡∂≠‡∑í ‡∂±‡∑Ä‡∑ì‡∂± ‡∑Ä‡∑ô‡∂∂‡∑ä ‡∂Ö‡∂©‡∑Ä‡∑í‡∂∫‡∂∫‡∑í.
                </p>
                <br>
                <button class="btn" style="width: auto; padding: 10px 30px;" onclick="navigate('students')">View Students</button>
            </div>

            <!-- Latest Announcements Preview -->
            <div class="home-announcements">
                <h3 class="home-ann-title"><i class="fas fa-bullhorn"></i> Latest News</h3>
                <div class="grid-container" id="home-ann-grid">
                    <!-- JS loads here -->
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <button class="btn" style="width: auto; background: rgba(255,255,255,0.1);" onclick="navigate('announcements')">View All Announcements</button>
                </div>
            </div>
        </section>

        <!-- 2. Announcements Section -->
        <section id="announcements">
            <center><h2 class="section-title">Class Announcements</h2></center>
            
            <div id="admin-announce-panel" class="glass-content form-container" style="display: none; border: 2px solid var(--owner-gold);">
                <h3 style="color: var(--owner-gold); margin-bottom: 15px; text-align: center;"><i class="fas fa-crown"></i> Post New Announcement</h3>
                <div class="form-group">
                    <label>‡∂∏‡∑è‡∂≠‡∑ò‡∂ö‡∑è‡∑Ä (Title)</label>
                    <input type="text" id="ann-title" class="form-control" placeholder="Eg: Extra Class Tomorrow">
                </div>
                <div class="form-group">
                    <label>‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª (Message)</label>
                    <textarea id="ann-msg" class="form-control" rows="4" placeholder="Announcement details..."></textarea>
                </div>
                <button class="btn" onclick="postAnnouncement()">Post Announcement</button>
                <br>
                <button class="btn btn-danger" onclick="clearAllAnnouncements()">Delete All</button>
            </div>

            <br>
            <div class="grid-container" id="announcement-grid">
                <!-- JS loads here -->
            </div>
        </section>

        <!-- 3. Students Section -->
        <section id="students">
            <center><h2 class="section-title">Grade 10 Students</h2></center>
            <div class="grid-container" id="student-grid">
                <!-- JS loads here -->
            </div>
        </section>

        <!-- 4. Teacher Section -->
        <section id="teacher">
            <center><h2 class="section-title">Class Teacher</h2></center>
            <div class="glass-content card" style="max-width: 500px; margin: 0 auto;">
                <img src="https://ui-avatars.com/api/?name=Pavithra+Hirushini&background=8f94fb&color=fff&size=150" alt="Teacher" class="avatar">
                <h3>M.R.S. Pavithra Hirushini</h3>
                <p style="font-weight: bold; color: var(--secondary-color); margin-bottom: 10px;">Grade 10 Class Teacher</p>
                <p>"We are committed to guiding our students towards a bright future."</p>
            </div>
        </section>

        <!-- 5. Report Sending -->
        <section id="reports">
            <center><h2 class="section-title">Report System</h2></center>
            
            <div class="glass-content form-container">
                <h3 style="margin-bottom: 20px;">Send a Report</h3>
                <div class="form-group">
                    <label>Your Name</label>
                    <input type="text" id="rep-name" class="form-control" placeholder="Name">
                </div>
                <div class="form-group">
                    <label>Subject</label>
                    <input type="text" id="rep-subject" class="form-control" placeholder="Subject">
                </div>
                <div class="form-group">
                    <label>Message</label>
                    <textarea id="rep-msg" class="form-control" rows="4" placeholder="Details..."></textarea>
                </div>
                <button class="btn" onclick="submitReport()">Submit Report</button>
            </div>

            <div id="report-list-container" class="glass-content" style="margin-top: 40px; padding: 20px; display: none;">
                <h3 style="margin-bottom: 20px; border-bottom: 1px solid #fff; padding-bottom: 10px;">
                    <i class="fas fa-file-alt"></i> Received Reports (Owner Only)
                </h3>
                <div id="report-list"></div>
            </div>
            
            <div id="report-login-msg" class="glass-content" style="margin-top: 20px; padding: 15px; text-align: center; display: none; background: rgba(255, 71, 87, 0.2);">
                <i class="fas fa-lock"></i> Please login as <strong>Owner</strong> to view reports.
            </div>
        </section>

        <!-- 6. Credit Page -->
        <section id="credits">
            <center><h2 class="section-title">About Credit</h2></center>
            <div class="glass-content card" style="max-width: 400px; margin: 0 auto; animation: float 6s ease-in-out infinite;">
                <img src="https://picsum.photos/seed/shenal/150/150" alt="Shenal" class="avatar" style="border-color: var(--owner-gold);">
                <h3 style="color: var(--owner-gold);">Shenal Anuhas</h3>
                <p style="margin-bottom: 10px;"><strong>Age:</strong> 15+</p>
                <p style="margin-bottom: 20px;">Full Stack Developer</p>
                
                <a href="https://t.me/Crypto_RIV" target="_blank" class="btn" style="background: #0088cc;">
                    <i class="fab fa-telegram-plane"></i> Telegram
                </a>
            </div>
        </section>

        <!-- 7. Login Page -->
        <section id="login">
            <center><h2 class="section-title">Login</h2></center>
            <div class="glass-content form-container">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="login-name" class="form-control" placeholder="User Name">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="login-pass" class="form-control" placeholder="Password">
                </div>
                <button class="btn" onclick="login()">Login</button>
                <p style="margin-top: 15px; text-align: center; font-size: 0.9rem;">
                    No account? <a href="#" onclick="navigate('register')" style="color: var(--secondary-color);">Register</a>
                </p>
            </div>
        </section>

        <!-- 8. Register Page -->
        <section id="register">
            <center><h2 class="section-title">Register</h2></center>
            <div class="glass-content form-container">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="reg-name" class="form-control" placeholder="Your Name">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="reg-pass" class="form-control" placeholder="Create Password">
                </div>
                <button class="btn" onclick="register()">Create Account</button>
                <p style="margin-top: 15px; text-align: center; font-size: 0.9rem;">
                    Already have an account? <a href="#" onclick="navigate('login')" style="color: var(--secondary-color);">Login</a>
                </p>
            </div>
        </section>

    </div>

    <!-- --- AI Chatbot Widget --- -->
    <div id="ai-chat-widget">
        <!-- Chat Window -->
        <div id="chat-window">
            <div id="chat-header">
                <h3><i class="fas fa-robot"></i> AI Tutor</h3>
                <div class="chat-controls">
                    <button class="lang-btn active" onclick="setChatLang('en')" title="English">EN</button>
                    <button class="lang-btn" onclick="setChatLang('si')" title="‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω">SI</button>
                    <button class="lang-btn" onclick="setChatLang('ta')" title="‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç">TA</button>
                    <button id="close-chat" onclick="toggleChat()"><i class="fas fa-times"></i></button>
                </div>
            </div>
            <div id="chat-body">
                <div class="chat-msg msg-ai">
                    Hello! I am your AI study assistant. Ask me anything about your subjects! üìö
                </div>
                <div class="typing-indicator" id="typing-indicator">
                    <div class="typing-dots"><span></span><span></span><span></span></div>
                </div>
            </div>
            <div class="chat-disclaimer">
                For Learning Purposes Only. AI may make mistakes.
            </div>
            <div id="chat-footer">
                <input type="text" id="chat-input" placeholder="Ask something..." onkeypress="handleChatEnter(event)">
                <button id="send-chat" onclick="sendChatMessage()"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>

        <!-- Floating Toggle Button -->
        <button id="chat-toggle-btn" onclick="toggleChat()">
            <i class="fas fa-comment-dots"></i>
        </button>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">Operation Successful</div>

    <script>
        // --- Data Section ---
        const studentsData = [
            { name: "‡∂â‡∑Ç‡∑è‡∂±‡∑ä ‡∂±‡∑ô‡∂≠‡∑ä‡∂∏‡∑í‡∂ö", desc: "‡∂â‡∑Ç‡∑è‡∂±‡∑ä ‡∑Ñ‡∑ú‡∂≥ ‡∂ú‡∑î‡∂´‡∂ú‡∂≠‡∑í‡∂ö ‡∂Ø‡∂ª‡∑î‡∑Ä‡∑ô‡∂ö‡∑í.", color: "#ff7675" },
            { name: "‡∑Ñ‡∑í‡∂∏‡∑è‡∑Ç‡∑ä ‡∑É‡∂Ç‡∂¢‡∂±", desc: "‡∂¥‡∑É‡∑î‡∂ú‡∑í‡∂∫ ‡∑Ä‡∑É‡∂ª ‡∂ö‡∑í‡∑Ñ‡∑í‡∂¥‡∂∫ ‡∂≠‡∑î‡∑Ö ‡∂¥‡∑è‡∑É‡∂Ω‡∑ä ‡∂¥‡∑ê‡∂∏‡∑í‡∂´‡∑ì‡∂∏ ‡∂Ö‡∂©‡∑î ‡∑Ä‡∑ì ‡∂á‡∂≠.", color: "#74b9ff" },
            { name: "‡∂â‡∑É‡∑î‡∂ª‡∑î ‡∂∏‡∂Ø‡∑î‡∑É‡∂Ç‡∂õ", desc: "‡∂â‡∂≠‡∑è ‡∂ã‡∂±‡∂±‡∑ä‡∂Ø‡∑î‡∑Ä‡∑ô‡∂±‡∑ä ‡∂Ö‡∂∞‡∑ä‚Äç‡∂∫‡∑è‡∂¥‡∂±‡∂∫ ‡∂ö‡∂ª‡∂∫‡∑í.", color: "#55efc4" },
            { name: "‡∂±‡∑Ä‡∑ì‡∂±‡∑ä ‡∂≠‡∂ª‡∑î‡∑Ç", desc: "‡∂â‡∂≠‡∑è ‡∂∂‡∑î‡∂Ø‡∑ä‡∂∞‡∑í‡∂∏‡∂≠‡∑ä ‡∂Ø‡∂ª‡∑î‡∑Ä‡∑ô‡∂ö‡∑í.", color: "#ffeaa7" },
            { name: "‡∂∏‡∑è‡∂Ω‡∑í‡∂Ø‡∑î ‡∑Ñ‡∑í‡∂ª‡∑î‡∑Ç‡∑è‡∂±‡∑ä", desc: "‡∂â‡∂≠‡∑è ‡∂ö‡∑ê‡∂¥‡∑Ä‡∑ì‡∂∏‡∑ô‡∂±‡∑ä ‡∂Ö‡∂∞‡∑ä‚Äç‡∂∫‡∑è‡∂¥‡∂±‡∂∫ ‡∂ö‡∂ª‡∂± ‡∂Ø‡∂ª‡∑î‡∑Ä‡∑ô‡∂ö‡∑í.", color: "#a29bfe" },
            { name: "‡∂≠‡∑í‡∂ö‡∑ä‡∑Ç‡∂´ ‡∑Ä‡∑í‡∂Ø‡∑î‡∂ª‡∂Ç‡∂ú", desc: "‡∂ã‡∂±‡∂±‡∑ä‡∂Ø‡∑î‡∑Ä ‡∑Ñ‡∑ö‡∂≠‡∑î‡∑Ä‡∑ô‡∂±‡∑ä ‡∂¢‡∑ì‡∑Ä‡∑í‡∂≠‡∂∫‡∑ö ‡∂Ö‡∂∑‡∑í‡∂∫‡∑ù‡∂ú ‡∂¢‡∂∫‡∂ú‡∂≠ ‡∑Ñ‡∑ê‡∂ö‡∑í.", color: "#fd79a8" },
            { name: "‡∑É‡∂Ç‡∂¢‡∂± ‡∂¥‡∑ä‚Äç‡∂ª‡∂∂‡∂≠‡∑ä", desc: "GOOD BOY .", color: "#e17055" },
            { name: "‡∑Å‡∑ô‡∂±‡∑è‡∂Ω‡∑ä ‡∂Ö‡∂±‡∑î‡∑Ñ‡∑É‡∑ä", desc: "Developer.", color: "#6c5ce7", isOwner: true },
            { name: "‡∂≠‡∑è‡∂ª‡∂ö ‡∂¥‡∑ä‚Äç‡∂ª‡∑É‡∂±‡∑ä‡∂±", desc: "‡∂≠‡∑è‡∂ª‡∂ö ‡∂ú‡∑ê‡∂± ‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª ‡∂±‡∑ú‡∂Ø‡∂ö‡∑ä‡∑Ä‡∂∫‡∑í üòê", color: "#b2bec3" }
        ];

        // --- State Management ---
        let currentUser = null;
        let isOwner = false;

        // --- AI Chatbot State ---
        let currentLang = 'en';
        const aiResponses = {
            en: {
                greeting: "Hello! I am your AI study assistant. How can I help you today?",
                topics: ["math", "science", "history", "english", "exam", "homework"],
                generic: "I can help with Math, Science, History, and Exam tips. Ask me a specific question!",
                safety: "I am designed only for educational purposes. I cannot answer that.",
                math: "Math requires practice. Are you asking about Algebra, Geometry, or Trigonometry?",
                science: "Science is fascinating! Is your question about Biology, Chemistry, or Physics?",
                tips: "To prepare for exams, make a schedule, review past papers, and get enough sleep!"
            },
            si: {
                greeting: "‡∂Ü‡∂∫‡∑î‡∂∂‡∑ù‡∑Ä‡∂±‡∑ä! ‡∂∏‡∂∏ ‡∂î‡∂∂‡∑ö AI ‡∂Ö‡∂∞‡∑ä‚Äç‡∂∫‡∑è‡∂¥‡∂± ‡∑É‡∑Ñ‡∂∫‡∂ö‡∑è‡∂ª. ‡∂∏‡∂ß ‡∂∏‡∑ú‡∂±‡∑Ä‡∑è ‡∂Ø‡∑ê‡∂±‡∂ú‡∂±‡∑ä‡∂± ‡∂ï‡∂±?",
                topics: ["‡∂ú‡∂´‡∑í‡∂≠‡∂∫", "‡∑Ä‡∑í‡∂Ø‡∑ä‚Äç‡∂∫‡∑è‡∑Ä", "‡∂â‡∂≠‡∑í‡∑Ñ‡∑è‡∑É‡∂∫", "‡∂â‡∂Ç‡∂ú‡∑ä‚Äç‡∂ª‡∑ì‡∑É‡∑í", "‡∑Ä‡∑í‡∂∑‡∑è‡∂ú‡∂∫", "‡∑Ä‡∑í‡∑Ç‡∂∫"],
                generic: "‡∂∏‡∂ß ‡∂ú‡∂´‡∑í‡∂≠‡∂∫, ‡∑Ä‡∑í‡∂Ø‡∑ä‚Äç‡∂∫‡∑è‡∑Ä, ‡∂â‡∂≠‡∑í‡∑Ñ‡∑è‡∑É‡∂∫ ‡∑É‡∑Ñ ‡∑Ä‡∑í‡∂∑‡∑è‡∂ú ‡∂ã‡∂¥‡∂Ø‡∑ö‡∑Å ‡∂ú‡∑ê‡∂± ‡∂ã‡∂Ø‡∑Ä‡∑ä ‡∂ö‡∂Ω ‡∑Ñ‡∑ê‡∂ö. ‡∑Ä‡∑í‡∑Å‡∑ö‡∑Ç ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∂∫‡∂ö‡∑ä ‡∂Ö‡∑Ñ‡∂±‡∑ä‡∂±!",
                safety: "‡∂∏‡∂∏ ‡∂Ö‡∂∞‡∑ä‚Äç‡∂∫‡∑è‡∂¥‡∂±‡∂∫ ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂¥‡∂∏‡∂´‡∂ö‡∑ä ‡∑É‡∑ê‡∂ö‡∑É‡∑î ‡∂á‡∂≠. ‡∂∏‡∂ß ‡∂ä‡∂ß ‡∂Ö‡∂Ø‡∑è‡∑Ö ‡∂±‡∑ê‡∂≠.",
                math: "‡∂ú‡∂´‡∑í‡∂≠‡∂∫ ‡∂¥‡∑î‡∑Ñ‡∑î‡∂´‡∑î‡∑Ä‡∂ö‡∑ä ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫ ‡∑Ä‡∑ö. ‡∂î‡∂∂ ‡∑Ä‡∑ì‡∂¢ ‡∂ú‡∂´‡∑í‡∂≠‡∂∫, ‡∂¢‡∑ä‚Äç‡∂∫‡∑è‡∂∏‡∑í‡∂≠‡∑í‡∂∫ ‡∂±‡∑ê‡∂≠‡∑Ñ‡∑ú‡∂≠‡∑ä ‡∂≠‡∑ä‚Äç‡∂ª‡∑í‡∂ö‡∑ù‡∂´‡∂∏‡∑í‡∂≠‡∑í‡∂∫ ‡∂ú‡∑ê‡∂± ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂± ‡∂ö‡∂ª‡∂±‡∑ä‡∂±‡∂Ø?",
                science: "‡∑Ä‡∑í‡∂Ø‡∑ä‚Äç‡∂∫‡∑è‡∑Ä ‡∂¥‡∑î‡∂Ø‡∑î‡∂∏ ‡∑É‡∑Ñ‡∂ú‡∂≠‡∂∫‡∑í! ‡∂¢‡∑ì‡∑Ä ‡∑Ä‡∑í‡∂Ø‡∑ä‚Äç‡∂∫‡∑è‡∑Ä, ‡∂ª‡∑É‡∑è‡∂∫‡∂± ‡∑Ä‡∑í‡∂Ø‡∑ä‚Äç‡∂∫‡∑è‡∑Ä ‡∂±‡∑ê‡∂≠‡∑Ñ‡∑ú‡∂≠‡∑ä ‡∂∑‡∑û‡∂≠‡∑í‡∂ö ‡∑Ä‡∑í‡∂Ø‡∑ä‚Äç‡∂∫‡∑è‡∑Ä ‡∂ú‡∑ê‡∂± ‡∂Ø?",
                tips: "‡∑Ä‡∑í‡∂∑‡∑è‡∂ú ‡∑É‡∂≥‡∑Ñ‡∑è ‡∑É‡∑ñ‡∂Ø‡∑è‡∂±‡∂∏‡∑ä ‡∑Ä‡∑ì‡∂∏‡∂ß ‡∂ö‡∑è‡∂Ω ‡∑É‡∂ß‡∑Ñ‡∂±‡∂ö‡∑ä ‡∑É‡∂ö‡∑É‡∂±‡∑ä‡∂±, ‡∂¥‡∑ê‡∂ª‡∂´‡∑í ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂± ‡∂¥‡∂≠‡∑ä‚Äç‡∂ª ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∑è ‡∂ö‡∂ª‡∂±‡∑ä‡∂± ‡∑É‡∑Ñ ‡∂¥‡∑ä‚Äç‡∂ª‡∂∏‡∑è‡∂´‡∑Ä‡∂≠‡∑ä ‡∂±‡∑í‡∂±‡∑ä‡∂Ø‡∂ö‡∑ä ‡∂ú‡∂±‡∑ä‡∂±!"
            },
            ta: {
                greeting: "‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç! ‡Æ®‡Ææ‡Æ©‡Øç ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç AI ‡Æï‡Æ≤‡Øç‡Æµ‡Æø ‡Æâ‡Æ§‡Æµ‡Æø‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç. ‡Æ®‡Ææ‡Æ©‡Øç ‡Æé‡Æ™‡Øç‡Æ™‡Æü‡Æø ‡Æâ‡Æ§‡Æµ ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡ØÅ‡ÆÆ‡Øç?",
                topics: ["‡Æï‡Æ£‡Æø‡Æ§‡ÆÆ‡Øç", "‡ÆÖ‡Æ±‡Æø‡Æµ‡Æø‡ÆØ‡Æ≤‡Øç", "‡Æµ‡Æ∞‡Æ≤‡Ææ‡Æ±‡ØÅ", "‡ÆÜ‡Æô‡Øç‡Æï‡Æø‡Æ≤‡ÆÆ‡Øç", "‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ", "‡Æ™‡Ææ‡Æü‡ÆÆ‡Øç"],
                generic: "‡Æï‡Æ£‡Æø‡Æ§‡ÆÆ‡Øç, ‡ÆÖ‡Æ±‡Æø‡Æµ‡Æø‡ÆØ‡Æ≤‡Øç, ‡Æµ‡Æ∞‡Æ≤‡Ææ‡Æ±‡ØÅ ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ ‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç ‡Æ™‡Æ±‡Øç‡Æ±‡Æø ‡Æâ‡Æ§‡Æµ ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡ØÅ‡ÆÆ‡Øç. ‡Æí‡Æ∞‡ØÅ ‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡Æø‡Æü‡Øç‡Æü ‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø‡ÆØ‡Øà‡Æï‡Øç ‡Æï‡Øá‡Æ≥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç!",
                safety: "‡Æ®‡Ææ‡Æ©‡Øç ‡Æï‡Æ≤‡Øç‡Æµ‡Æø ‡Æ®‡Øã‡Æï‡Øç‡Æï‡Æ§‡Øç‡Æ§‡Æø‡Æ±‡Øç‡Æï‡Ææ‡Æï ‡ÆÆ‡Æü‡Øç‡Æü‡ØÅ‡ÆÆ‡Øá ‡Æµ‡Æü‡Æø‡Æµ‡ÆÆ‡Øà‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡ØÅ‡Æ≥‡Øç‡Æ≥‡Øá‡Æ©‡Øç. ‡ÆÖ‡Æ§‡Æ±‡Øç‡Æï‡ØÅ ‡Æ®‡Ææ‡Æ©‡Øç ‡Æ™‡Æ§‡Æø‡Æ≤‡Æ≥‡Æø‡Æï‡Øç‡Æï ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡Ææ‡Æ§‡ØÅ.",
                math: "‡Æï‡Æ£‡Æø‡Æ§‡ÆÆ‡Øç ‡Æ®‡Æü‡Øà‡ÆÆ‡ØÅ‡Æ±‡Øà ‡Æ§‡Øá‡Æµ‡Øà‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ. ‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æá‡ÆØ‡Æ±‡Øç‡Æï‡Æ£‡Æø‡Æ§‡ÆÆ‡Øç, ‡Æµ‡Æü‡Æø‡Æµ‡Æø‡ÆØ‡Æ≤‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡ÆÆ‡ØÅ‡Æï‡Øç‡Æï‡Øã‡Æ£‡Æµ‡Æø‡ÆØ‡Æ≤‡Øç ‡Æ™‡Æ±‡Øç‡Æ±‡Æø ‡Æï‡Øá‡Æü‡Øç‡Æï‡Æø‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Ææ?",
                science: "‡ÆÖ‡Æ±‡Æø‡Æµ‡Æø‡ÆØ‡Æ≤‡Øç ‡ÆÖ‡Æ±‡Øç‡Æ™‡ØÅ‡Æ§‡ÆÆ‡Ææ‡Æ©‡Æ§‡ØÅ! ‡Æâ‡ÆØ‡Æø‡Æ∞‡Æø‡ÆØ‡Æ≤‡Øç, ‡Æµ‡Øá‡Æ§‡Æø‡ÆØ‡Æø‡ÆØ‡Æ≤‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æá‡ÆØ‡Æ±‡Øç‡Æ™‡Æø‡ÆØ‡Æ≤‡Øç ‡Æ™‡Æ±‡Øç‡Æ±‡Æø ‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø‡ÆØ‡Ææ?",
                tips: "‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡Æ§‡Øç ‡Æ§‡ÆØ‡Ææ‡Æ∞‡Ææ‡Æµ‡Æ§‡Æ±‡Øç‡Æï‡ØÅ, ‡Æï‡Ææ‡Æ≤ ‡ÆÖ‡Æü‡Øç‡Æü‡Æµ‡Æ£‡Øà ‡Æ§‡ÆØ‡Ææ‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç, ‡ÆÆ‡ØÅ‡Æ®‡Øç‡Æ§‡Øà‡ÆØ ‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø‡Æ§‡Øç‡Æ§‡Ææ‡Æ≥‡Øç‡Æï‡Æ≥‡Øà ‡ÆÆ‡Æ§‡Æø‡Æ™‡Øç‡Æ™‡Ææ‡ÆØ‡Øç‡Æµ‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç!"
            }
        };

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            renderStudents();
            checkSession();
            loadAnnouncements();
        });

        // --- Navigation Logic ---
        function navigate(sectionId) {
            document.querySelectorAll('section').forEach(sec => sec.classList.remove('active-section'));
            document.querySelectorAll('.nav-links a').forEach(link => link.classList.remove('active'));

            document.getElementById(sectionId).classList.add('active-section');
            
            const links = document.querySelectorAll('.nav-links a');
            links.forEach(link => {
                if(link.getAttribute('onclick') && link.getAttribute('onclick').includes(sectionId)) {
                    link.classList.add('active');
                }
            });

            document.getElementById('navLinks').classList.remove('mobile-active');

            if(sectionId === 'reports') loadReports();
            if(sectionId === 'announcements') renderAnnouncements(); 
            if(sectionId === 'home') renderHomeAnnouncements();
        }

        function toggleMobileMenu() {
            document.getElementById('navLinks').classList.toggle('mobile-active');
        }

        // --- Render Students ---
        function renderStudents() {
            const grid = document.getElementById('student-grid');
            grid.innerHTML = '';
            studentsData.forEach((student) => {
                const avatarUrl = student.isOwner 
                    ? `https://ui-avatars.com/api/?name=${student.name}&background=ffd700&color=000&bold=true`
                    : `https://ui-avatars.com/api/?name=${student.name}&background=random`;

                const card = document.createElement('div');
                card.className = 'glass-content card';
                card.innerHTML = `
                    <img src="${avatarUrl}" alt="${student.name}" class="avatar">
                    <h3>${student.name} ${student.isOwner ? '<i class="fas fa-crown" style="color: gold;"></i>' : ''}</h3>
                    <p>${student.desc}</p>
                `;
                grid.appendChild(card);
            });
        }

        // --- Announcement System ---
        function loadAnnouncements() {
            let announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            if (announcements.length === 0) {
                const defaultAnn = { id: Date.now(), title: "Welcome to Jayapala School System", msg: "Welcome! This is the default announcement.", date: new Date().toLocaleDateString() };
                announcements.push(defaultAnn);
                localStorage.setItem('announcements', JSON.stringify(announcements));
            }
            renderAnnouncements();
            renderHomeAnnouncements();
        }

        function renderHomeAnnouncements() {
            const grid = document.getElementById('home-ann-grid');
            const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            grid.innerHTML = '';
            announcements.sort((a, b) => b.id - a.id);
            announcements.slice(0, 2).forEach((ann) => {
                const card = document.createElement('div');
                const isToday = ann.date === new Date().toLocaleDateString();
                card.className = isToday ? 'glass-content ann-card new' : 'glass-content ann-card';
                card.innerHTML = `
                    <span class="ann-date"><i class="far fa-calendar-alt"></i> ${ann.date}</span>
                    <h3 class="ann-title">${ann.title}</h3>
                    <p>${ann.msg.substring(0, 100)}${ann.msg.length > 100 ? '...' : ''}</p>
                `;
                grid.appendChild(card);
            });
        }

        function renderAnnouncements() {
            const grid = document.getElementById('announcement-grid');
            const adminPanel = document.getElementById('admin-announce-panel');
            const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            
            grid.innerHTML = '';
            adminPanel.style.display = isOwner ? 'block' : 'none';
            announcements.sort((a, b) => b.id - a.id);

            announcements.forEach((ann) => {
                const card = document.createElement('div');
                const isToday = ann.date === new Date().toLocaleDateString();
                card.className = isToday ? 'glass-content ann-card new' : 'glass-content ann-card';
                card.innerHTML = `
                    <span class="ann-date"><i class="far fa-calendar-alt"></i> ${ann.date}</span>
                    <h3 class="ann-title">${ann.title}</h3>
                    <p>${ann.msg}</p>
                `;
                grid.appendChild(card);
            });
        }

        function postAnnouncement() {
            const title = document.getElementById('ann-title').value.trim();
            const msg = document.getElementById('ann-msg').value.trim();
            if (!title || !msg) return showToast("Please enter a title and message.");

            const newAnn = { id: Date.now(), title: title, msg: msg, date: new Date().toLocaleDateString() };
            const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            announcements.push(newAnn);
            localStorage.setItem('announcements', JSON.stringify(announcements));

            document.getElementById('ann-title').value = '';
            document.getElementById('ann-msg').value = '';
            showToast("Announcement Posted!");
            renderAnnouncements();
            renderHomeAnnouncements();
        }

        function clearAllAnnouncements() {
            if(confirm("Delete all announcements?")) {
                localStorage.removeItem('announcements');
                loadAnnouncements();
                showToast("All announcements cleared.");
            }
        }

        // --- Auth & Reports ---
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.innerText = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function checkSession() {
            const user = localStorage.getItem('currentUser');
            if (user) {
                const userData = JSON.parse(user);
                loginSuccess(userData.name, userData.isOwner, false);
            }
        }

        function register() {
            const name = document.getElementById('reg-name').value.trim();
            const pass = document.getElementById('reg-pass').value.trim();
            if (!name || !pass) return showToast("Please fill in all fields.");
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            if (users.find(u => u.name === name)) return showToast("User already exists.");
            users.push({ name, pass });
            localStorage.setItem('users', JSON.stringify(users));
            showToast("Registration successful!"); navigate('login');
        }

        function login() {
            const name = document.getElementById('login-name').value.trim();
            const pass = document.getElementById('login-pass').value.trim();
            if (name === 'Shenal Anuhas' && pass === 'shenal11') return loginSuccess(name, true, true);
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const validUser = users.find(u => u.name === name && u.pass === pass);
            if (validUser) loginSuccess(validUser.name, false, true);
            else showToast("Invalid username or password.");
        }

        function loginSuccess(name, ownerFlag, saveSession) {
            currentUser = name; isOwner = ownerFlag;
            document.getElementById('nav-login').style.display = 'none';
            document.getElementById('nav-register').style.display = 'none';
            document.getElementById('nav-logout').style.display = 'block';
            document.getElementById('user-display').style.display = 'flex';
            document.getElementById('username-span').innerText = name;
            document.getElementById('owner-display').style.display = isOwner ? 'flex' : 'none';
            if (saveSession) localStorage.setItem('currentUser', JSON.stringify({ name, isOwner }));
            showToast(`Welcome, ${name}!`);
            navigate('home');
            renderAnnouncements(); 
        }

        function logout() {
            localStorage.removeItem('currentUser');
            currentUser = null; isOwner = false;
            document.getElementById('nav-login').style.display = 'block';
            document.getElementById('nav-register').style.display = 'block';
            document.getElementById('nav-logout').style.display = 'none';
            document.getElementById('user-display').style.display = 'none';
            document.getElementById('owner-display').style.display = 'none';
            showToast("Logged out.");
            navigate('home');
            renderAnnouncements();
        }

        function submitReport() {
            const name = document.getElementById('rep-name').value.trim();
            const subject = document.getElementById('rep-subject').value.trim();
            const msg = document.getElementById('rep-msg').value.trim();
            if (!name || !subject || !msg) return showToast("Please fill all fields.");
            const newReport = { name, subject, msg, date: new Date().toLocaleString() };
            const reports = JSON.parse(localStorage.getItem('reports') || '[]');
            reports.push(newReport);
            localStorage.setItem('reports', JSON.stringify(reports));
            showToast("Report sent successfully!");
            document.getElementById('rep-name').value = ''; document.getElementById('rep-subject').value = ''; document.getElementById('rep-msg').value = '';
        }

        function loadReports() {
            const container = document.getElementById('report-list-container');
            const list = document.getElementById('report-list');
            const errorMsg = document.getElementById('report-login-msg');
            container.style.display = 'none'; errorMsg.style.display = 'none';

            if (!currentUser || !isOwner) { errorMsg.style.display = 'block'; return; }
            container.style.display = 'block';
            const reports = JSON.parse(localStorage.getItem('reports') || '[]');
            if (reports.length === 0) { list.innerHTML = '<div style="text-align:center; padding:20px; opacity:0.7;"><i class="fas fa-folder-open"></i> No reports submitted yet.</div>'; return; }
            list.innerHTML = '';
            reports.reverse().forEach((rep) => {
                const item = document.createElement('div');
                item.className = 'report-item glass-content';
                item.innerHTML = `
                    <div class="report-header"><strong>${rep.subject}</strong><small style="color:#ccc;">${rep.date}</small></div>
                    <p style="margin-bottom: 5px; font-weight:600; color:var(--secondary-color);">From: ${rep.name}</p>
                    <p style="margin-top: 10px; line-height: 1.4;">${rep.msg}</p>
                `;
                list.appendChild(item);
            });
        }

        // --- AI Chatbot Logic ---
        function toggleChat() {
            const window = document.getElementById('chat-window');
            window.style.display = window.style.display === 'flex' ? 'none' : 'flex';
        }

        function setChatLang(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.lang-btn[onclick="setChatLang('${lang}')"]`).classList.add('active');
            
            // Clear and reset greeting
            const body = document.getElementById('chat-body');
            body.innerHTML = '';
            const typing = document.getElementById('typing-indicator');
            typing.style.display = 'none';
            
            addAiMessage(aiResponses[lang].greeting);
        }

        function handleChatEnter(e) {
            if (e.key === 'Enter') sendChatMessage();
        }

        function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text) return;

            addUserMessage(text);
            input.value = '';

            // Show typing indicator
            const typing = document.getElementById('typing-indicator');
            typing.style.display = 'block';
            document.getElementById('chat-body').scrollTop = document.getElementById('chat-body').scrollHeight;

            // Simulate AI Delay
            setTimeout(() => {
                typing.style.display = 'none';
                const response = generateAIResponse(text);
                addAiMessage(response);
            }, 1000 + Math.random() * 1000);
        }

        function addUserMessage(text) {
            const body = document.getElementById('chat-body');
            const div = document.createElement('div');
            div.className = 'chat-msg msg-user';
            div.innerText = text;
            body.insertBefore(div, document.getElementById('typing-indicator'));
            body.scrollTop = body.scrollHeight;
        }

        function addAiMessage(text) {
            const body = document.getElementById('chat-body');
            const div = document.createElement('div');
            div.className = 'chat-msg msg-ai';
            div.innerText = text;
            body.insertBefore(div, document.getElementById('typing-indicator'));
            body.scrollTop = body.scrollHeight;
        }

        function generateAIResponse(text) {
            const lowerText = text.toLowerCase();
            const langData = aiResponses[currentLang];

            // Simple Keyword Matching (Simulating NLP)
            for (let topic of langData.topics) {
                if (lowerText.includes(topic)) {
                    if (topic === 'math' || topic === '‡∂ú‡∂´‡∑í‡∂≠‡∂∫' || topic === '‡Æï‡Æ£‡Æø‡Æ§‡ÆÆ‡Øç') return langData.math;
                    if (topic === 'science' || topic === '‡∑Ä‡∑í‡∂Ø‡∑ä‚Äç‡∂∫‡∑è‡∑Ä' || topic === '‡ÆÖ‡Æ±‡Æø‡Æµ‡Æø‡ÆØ‡Æ≤‡Øç') return langData.science;
                    if (topic === 'exam' || topic === 'homework' || topic === '‡∑Ä‡∑í‡∂∑‡∑è‡∂ú‡∂∫' || topic === '‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ') return langData.tips;
                    // If specific keyword found but not mapped above, return generic but relevant
                    return langData.generic;
                }
            }

            // Basic greeting detection
            if (lowerText.includes('hello') || lowerText.includes('hi') || lowerText.includes('‡∑Ñ‡∑è‡∂∫‡∑í') || lowerText.includes('‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç')) {
                return langData.greeting;
            }

            // Safety fallback (Simulated)
            if (lowerText.includes('bad') || lowerText.includes('hate') || lowerText.includes('kill')) {
                return langData.safety;
            }

            return langData.generic;
        }

    </script>
</body>
</html>
